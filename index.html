<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Oasis</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  
  <!-- Google Maps API -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBFw0Qbyq9zTFTd-tUY6dO_X8VvGGJ42Z8&libraries=places"></script>
  
  <style>
    :root {
      --primary-navy: #1e3a8a;
      --primary-teal: #0d9488;
      --secondary-blue: #3b82f6;
      --secondary-green: #10b981;
      --accent-orange: #f59e0b;
      --neutral-50: #f8fafc;
      --neutral-100: #f1f5f9;
      --neutral-200: #e2e8f0;
      --neutral-300: #cbd5e1;
      --neutral-400: #94a3b8;
      --neutral-500: #64748b;
      --neutral-600: #475569;
      --neutral-700: #334155;
      --neutral-800: #1e293b;
      --neutral-900: #0f172a;
      --gradient-primary: linear-gradient(135deg, var(--primary-navy) 0%, var(--primary-teal) 100%);
      --gradient-secondary: linear-gradient(135deg, var(--secondary-blue) 0%, var(--secondary-green) 100%);
      --gradient-hero: linear-gradient(135deg, rgba(30, 58, 138, 0.9) 0%, rgba(13, 148, 136, 0.9) 50%, rgba(59, 130, 246, 0.9) 100%);
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
      --shadow-2xl: 0 25px 50px -12px rgb(0 0 0 / 0.25);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
      overflow-x: hidden;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      line-height: 1.6;
      color: var(--neutral-700);
      background: var(--neutral-50);
      overflow-x: hidden;
    }

    /* Page System */
    .page {
      display: none;
    }

    .page.active {
      display: block;
    }

    /* Animations */
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(60px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes backgroundMove {
      0% { background-position: 0% 0%; }
      50% { background-position: 100% 100%; }
      100% { background-position: 0% 0%; }
    }

    /* Auth Page Styles */
    .auth-page {
      min-height: 100vh;
      background: 
        var(--gradient-hero),
        url('https://images.unsplash.com/photo-1542838132-92c53300491e?auto=format&fit=crop&w=1920&q=80') center/cover;
      background-attachment: fixed;
      animation: backgroundMove 20s ease-in-out infinite;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .auth-container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 24px;
      padding: 3rem;
      max-width: 450px;
      width: 90%;
      box-shadow: var(--shadow-2xl);
      border: 1px solid rgba(255, 255, 255, 0.2);
      position: relative;
      z-index: 2;
    }

    .auth-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .auth-logo {
      font-size: 2rem;
      font-weight: 800;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
    }

    .auth-title {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--neutral-800);
      margin-bottom: 0.5rem;
    }

    .auth-subtitle {
      color: var(--neutral-600);
      font-size: 0.95rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: block;
      font-weight: 600;
      color: var(--neutral-700);
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
    }

    .form-input {
      width: 100%;
      padding: 0.875rem 1rem;
      border: 2px solid var(--neutral-200);
      border-radius: 12px;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: white;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--primary-navy);
      box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
    }

    .btn-auth {
      width: 100%;
      background: var(--gradient-primary);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 1rem;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: var(--shadow-md);
      margin-bottom: 1rem;
    }

    .btn-auth:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-xl);
    }

    .btn-auth:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .auth-switch {
      text-align: center;
      color: var(--neutral-600);
      font-size: 0.9rem;
    }

    .auth-switch a {
      color: var(--primary-navy);
      text-decoration: none;
      font-weight: 600;
    }

    .auth-switch a:hover {
      text-decoration: underline;
    }

    .error-message {
      background: #fee2e2;
      color: #dc2626;
      padding: 0.75rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      font-size: 0.9rem;
      display: none;
    }

    .success-message {
      background: #d1fae5;
      color: #059669;
      padding: 0.75rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      font-size: 0.9rem;
      display: none;
    }

    /* Location Selection Page */
    .location-page {
      min-height: 100vh;
      background: var(--gradient-hero);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }

    .location-container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 24px;
      padding: 3rem;
      max-width: 600px;
      width: 100%;
      box-shadow: var(--shadow-2xl);
    }

    .location-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .location-title {
      font-size: 2rem;
      font-weight: 700;
      color: var(--neutral-800);
      margin-bottom: 1rem;
    }

    .location-subtitle {
      color: var(--neutral-600);
      font-size: 1rem;
      margin-bottom: 2rem;
    }

    #map {
      width: 100%;
      height: 400px;
      border-radius: 12px;
      margin-bottom: 2rem;
      border: 1px solid var(--neutral-200);
    }

    .location-input {
      width: 100%;
      padding: 1rem;
      border: 2px solid var(--neutral-200);
      border-radius: 12px;
      font-size: 1rem;
      margin-bottom: 1rem;
    }

    .btn-location {
      width: 100%;
      background: var(--gradient-primary);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 1rem;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    /* Navigation */
    .navbar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: rgba(30, 58, 138, 0.95);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: var(--shadow-lg);
      padding: 0;
      z-index: 1000;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .navbar-container {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 2rem;
    }

    .logo {
      font-size: 1.75rem;
      font-weight: 800;
      color: white;
      letter-spacing: -0.5px;
    }

    .nav-links {
      display: flex;
      list-style: none;
      gap: 0.5rem;
      align-items: center;
    }

    .nav-links a {
      color: rgba(255, 255, 255, 0.9);
      text-decoration: none;
      font-weight: 500;
      font-size: 0.95rem;
      padding: 0.75rem 1.25rem;
      border-radius: 12px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .nav-links a:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(-2px);
      color: white;
    }

    .btn-primary {
      background: var(--gradient-primary);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 1rem 2rem;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: var(--shadow-md);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-xl);
    }

    /* Main page styles */
    .hero {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      background: 
        var(--gradient-hero),
        url('https://images.unsplash.com/photo-1488459716781-31db52582fe9?auto=format&fit=crop&w=1920&q=80') center/cover;
      background-attachment: fixed;
      animation: backgroundMove 25s ease-in-out infinite;
      overflow: hidden;
    }

    .hero-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
      text-align: center;
      z-index: 2;
      position: relative;
      color: white;
    }

    .hero h1 {
      font-size: clamp(3rem, 6vw, 5.5rem);
      font-weight: 800;
      line-height: 1.1;
      margin-bottom: 1.5rem;
    }

    .section {
      padding: 8rem 2rem;
      position: relative;
      overflow: hidden;
    }

    .section-container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .section-header {
      text-align: center;
      margin-bottom: 5rem;
    }

    .section-title {
      font-size: clamp(2.5rem, 5vw, 4rem);
      font-weight: 800;
      color: var(--neutral-800);
      margin-bottom: 1.5rem;
      line-height: 1.2;
    }

    .section-subtitle {
      font-size: clamp(1.1rem, 2.5vw, 1.4rem);
      color: var(--neutral-600);
      max-width: 800px;
      margin: 0 auto;
      line-height: 1.6;
    }

    .text-gradient {
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Food grid and other styles... */
    .food-ordering-section {
      background: 
        linear-gradient(135deg, rgba(248, 250, 252, 0.95) 0%, rgba(241, 245, 249, 0.95) 100%),
        url('https://images.unsplash.com/photo-1495195134817-aeb325a55b65?auto=format&fit=crop&w=1920&q=80') center/cover;
      background-attachment: fixed;
    }

    .food-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin-top: 3rem;
    }

    .food-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: var(--shadow-lg);
      transition: all 0.3s ease;
      border: 1px solid var(--neutral-200);
    }

    .food-card:hover {
      transform: translateY(-8px);
      box-shadow: var(--shadow-2xl);
    }

    .food-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      transition: transform 0.3s ease;
    }

    .food-content {
      padding: 1.5rem;
    }

    .food-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-800);
      margin-bottom: 0.5rem;
    }

    .food-description {
      color: var(--neutral-600);
      font-size: 0.9rem;
      margin-bottom: 1rem;
      line-height: 1.5;
    }

    .food-price {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--secondary-green);
      margin-bottom: 1rem;
    }

    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .quantity-btn {
      width: 35px;
      height: 35px;
      border-radius: 8px;
      border: 2px solid var(--neutral-300);
      background: white;
      color: var(--neutral-700);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .quantity-btn:hover {
      border-color: var(--primary-navy);
      background: var(--primary-navy);
      color: white;
    }

    .quantity-display {
      font-weight: 600;
      color: var(--neutral-800);
      min-width: 30px;
      text-align: center;
    }

    .add-to-cart-btn {
      background: var(--gradient-primary);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 0.75rem 1.5rem;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .add-to-cart-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    /* Cart styles */
    .cart-icon {
      position: relative;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 8px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: rgba(255, 255, 255, 0.9);
    }

    .cart-icon:hover {
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }

    .cart-count {
      position: absolute;
      top: -2px;
      right: -2px;
      background: var(--accent-orange);
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 600;
    }

    .cart-sidebar {
      position: fixed;
      top: 0;
      right: -400px;
      width: 400px;
      height: 100vh;
      background: white;
      box-shadow: var(--shadow-2xl);
      z-index: 10000;
      transition: right 0.3s ease;
      overflow-y: auto;
    }

    .cart-sidebar.open {
      right: 0;
    }

    .cart-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 9999;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .cart-overlay.open {
      opacity: 1;
      visibility: visible;
    }

    .cart-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem 0;
      border-bottom: 1px solid var(--neutral-200);
    }

    .cart-item img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 8px;
    }

    .cart-item-details {
      flex: 1;
    }

    .cart-item-name {
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--neutral-800);
      margin-bottom: 0.25rem;
    }

    .cart-item-price {
      color: var(--secondary-green);
      font-weight: 600;
    }

    /* Payment Modal */
    .payment-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 20000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .payment-modal.open {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background: white;
      border-radius: 20px;
      padding: 2rem;
      max-width: 500px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      transform: scale(0.8);
      transition: transform 0.3s ease;
    }

    .payment-modal.open .modal-content {
      transform: scale(1);
    }

    .modal-header {
      text-align: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--neutral-200);
    }

    .modal-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--neutral-800);
      margin-bottom: 0.5rem;
    }

    .delivery-info {
      background: var(--neutral-50);
      padding: 1rem;
      border-radius: 12px;
      margin-bottom: 1.5rem;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
    }

    .info-label {
      font-weight: 600;
      color: var(--neutral-700);
    }

    .info-value {
      color: var(--neutral-600);
    }

    .order-summary {
      margin-bottom: 2rem;
    }

    .summary-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
      border-bottom: 1px solid var(--neutral-200);
    }

    .summary-total {
      font-weight: 700;
      font-size: 1.1rem;
      padding-top: 1rem;
      border-top: 2px solid var(--neutral-300);
    }

    .modal-actions {
      display: flex;
      gap: 1rem;
    }

    .btn-secondary {
      background: var(--neutral-300);
      color: var(--neutral-700);
      border: none;
      border-radius: 12px;
      padding: 0.75rem 1.5rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      flex: 1;
    }

    .btn-secondary:hover {
      background: var(--neutral-400);
    }

    /* Footer Styles */
    .footer {
      background: linear-gradient(135deg, var(--neutral-900) 0%, var(--neutral-800) 100%);
      color: white;
      padding: 4rem 2rem 2rem;
      margin-top: 0;
    }

    .footer-container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .footer-content {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 3rem;
      margin-bottom: 3rem;
    }

    .footer-section h3 {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      color: white;
    }

    .footer-section p {
      color: rgba(255, 255, 255, 0.8);
      line-height: 1.6;
      margin-bottom: 1rem;
    }

    .footer-links {
      list-style: none;
    }

    .footer-links li {
      margin-bottom: 0.75rem;
    }

    .footer-links a {
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .footer-links a:hover {
      color: white;
    }

    .footer-bottom {
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      padding-top: 2rem;
      text-align: center;
    }

    .footer-bottom p {
      color: rgba(255, 255, 255, 0.6);
      font-size: 0.9rem;
    }

    /* Contact Section */
    .contact-section {
      background: var(--neutral-50);
      padding: 8rem 2rem;
    }

    .contact-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 3rem;
      margin-top: 3rem;
    }

    .contact-card {
      background: white;
      padding: 2rem;
      border-radius: 20px;
      box-shadow: var(--shadow-lg);
      text-align: center;
      transition: transform 0.3s ease;
    }

    .contact-card:hover {
      transform: translateY(-5px);
    }

    .contact-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    .contact-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--neutral-800);
      margin-bottom: 0.5rem;
    }

    .contact-info {
      color: var(--neutral-600);
      font-size: 1rem;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .section {
        padding: 4rem 1rem;
      }

      .food-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }

      .cart-sidebar {
        width: 100%;
        right: -100%;
      }

      .modal-actions {
        flex-direction: column;
      }

      .navbar-container {
        flex-direction: column;
        gap: 1rem;
        padding: 1rem;
      }

      .nav-links {
        flex-wrap: wrap;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <!-- Authentication Page -->
  <div id="authPage" class="page auth-page active">
    <div class="auth-container">
      <div class="auth-header">
        <div class="auth-logo">Oasis</div>
        <h2 class="auth-title" id="authTitle">Welcome Back</h2>
        <p class="auth-subtitle" id="authSubtitle">Sign in to access fresh, healthy meals in your area</p>
      </div>

      <div class="error-message" id="errorMessage"></div>
      <div class="success-message" id="successMessage"></div>

      <form class="auth-form" id="authForm">
        <div class="form-group" id="nameGroup" style="display: none;">
          <label class="form-label">Full Name</label>
          <input type="text" class="form-input" id="fullName" placeholder="Enter your full name" required>
        </div>

        <div class="form-group" id="locationGroup" style="display: none;">
          <label class="form-label">Location</label>
          <input type="text" class="form-input" id="location" placeholder="Location (e.g. Chicago)" required>
        </div>

        <div class="form-group" id="contactGroup" style="display: none;">
          <label class="form-label">Contact</label>
          <input type="text" class="form-input" id="contact" placeholder="Enter your contact number" required>
        </div>

        <div class="form-group">
          <label class="form-label">Email Address</label>
          <input type="email" class="form-input" id="email" placeholder="Enter your email" required>
        </div>

        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" class="form-input" id="password" placeholder="Enter your password" required>
        </div>

        <div class="form-group" id="confirmPasswordGroup" style="display: none;">
          <label class="form-label">Confirm Password</label>
          <input type="password" class="form-input" id="confirmPassword" placeholder="Confirm your password" required>
        </div>

        <button type="submit" class="btn-auth" id="authButton">Sign In</button>
      </form>

      <div class="auth-switch">
        <span id="authSwitchText">Don't have an account?</span>
        <a href="#" id="authSwitchLink" onclick="handleAuthSwitch()">Sign up</a>
      </div>
    </div>
  </div>

  <!-- Location Selection Page -->
  <div id="locationPage" class="page location-page">
    <div class="location-container">
      <div class="location-header">
        <div class="auth-logo">Oasis</div>
        <h2 class="location-title">Select Your Location</h2>
        <p class="location-subtitle">Help us find the best food options near you in Chicago</p>
      </div>

      <div class="error-message" id="locationErrorMessage"></div>
      <div class="success-message" id="locationSuccessMessage"></div>

      <div id="map"></div>
      
      <input type="text" id="locationSearch" class="location-input" placeholder="Search for your location in Chicago..." />
      
      <div style="margin-bottom: 1rem;">
        <p style="color: var(--neutral-600); font-size: 0.9rem; text-align: center;">
          <strong>Selected:</strong> <span id="selectedLocation">Click on the map to select your location</span>
        </p>
      </div>

      <button id="confirmLocationBtn" class="btn-location" disabled>
        Confirm Location & Continue
      </button>
    </div>
  </div>

  <!-- Main Application Page -->
  <div id="mainPage" class="page">
    <!-- Navigation -->
    <nav class="navbar" id="navbar">
      <div class="navbar-container">
        <div class="logo">Oasis</div>
        <ul class="nav-links" id="navLinks">
          <li><a href="#hero">Home</a></li>
          <li><a href="#about">About</a></li>
          <li><a href="#foodOrdering">Order Food</a></li>
          <li><a href="donation.html">Donate</a></li>
          <li><a href="#contact">Contact</a></li>
          <li>
            <div class="cart-icon" id="cartIcon">
              üõí Cart
              <span class="cart-count" id="cartCount">0</span>
            </div>
          </li>
          <li><button class="btn-primary" onclick="logout()" style="padding: 0.5rem 1rem; font-size: 0.9rem;">Logout</button></li>
        </ul>
      </div>
    </nav>

    <!-- Cart Overlay -->
    <div class="cart-overlay" id="cartOverlay"></div>

    <!-- Cart Sidebar -->
    <div class="cart-sidebar" id="cartSidebar">
      <div style="padding: 2rem; border-bottom: 1px solid var(--neutral-200);">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <h3 style="font-size: 1.5rem; font-weight: 700; color: var(--neutral-800);">Your Cart</h3>
          <button id="closeCart" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--neutral-600);">&times;</button>
        </div>
      </div>
      <div id="cartItems" style="padding: 1rem 2rem; min-height: 200px;"></div>
      <div style="padding: 2rem; border-top: 1px solid var(--neutral-200);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
          <span style="font-size: 1.25rem; font-weight: 600;">Total:</span>
          <span id="cartTotal" style="font-size: 1.25rem; font-weight: 700; color: var(--secondary-green);">Free</span>
        </div>
        <button id="checkoutBtn" class="btn-primary" style="width: 100%; justify-content: center;">
          Proceed to Checkout
        </button>
      </div>
    </div>

    <!-- Payment Modal -->
    <div class="payment-modal" id="paymentModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Order Confirmation</h3>
          <p style="color: var(--neutral-600); font-size: 0.9rem;">Review your order details</p>
        </div>

        <div class="delivery-info">
          <h4 style="font-weight: 600; margin-bottom: 1rem; color: var(--neutral-800);">Delivery Information</h4>
          <div class="info-row">
            <span class="info-label">Delivery Method:</span>
            <span class="info-value">Free Pickup</span>
          </div>
          <div class="info-row">
            <span class="info-label">Estimated Time:</span>
            <span class="info-value">Ready in 30-45 minutes</span>
          </div>
          <div class="info-row">
            <span class="info-label">Location:</span>
            <span class="info-value">Community Kitchen - South Side</span>
          </div>
        </div>

        <div class="order-summary">
          <h4 style="font-weight: 600; margin-bottom: 1rem; color: var(--neutral-800);">Order Summary</h4>
          <div id="orderSummaryItems"></div>
          <div class="summary-total">
            <div style="display: flex; justify-content: space-between;">
              <span>Total:</span>
              <span style="color: var(--secondary-green);">FREE</span>
            </div>
          </div>
        </div>

        <div class="modal-actions">
          <button class="btn-secondary" onclick="closePaymentModal()">Cancel</button>
          <button class="btn-primary" onclick="confirmOrder()" style="flex: 1;">Confirm Order</button>
        </div>
      </div>
    </div>

    <!-- Hero Section -->
    <section class="hero" id="hero">
      <div class="hero-content">
        <h1>Connecting Communities to <span class="text-gradient">Nutritious Food</span></h1>
        <p style="font-size: clamp(1.25rem, 3vw, 1.75rem); font-weight: 400; margin-bottom: 3rem; opacity: 0.9; max-width: 800px; margin-left: auto; margin-right: auto; line-height: 1.4;">
          Bridging the gap in food deserts by connecting communities, donors, and local food providers for a healthier Chicago.
        </p>
        
        <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
          <a href="donation.html" class="btn-primary">
            Donate Now
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
            </svg>
          </a>
          <a href="#foodOrdering" class="btn-primary" style="background: white; color: var(--primary-navy); box-shadow: var(--shadow-lg);">
            Order Food
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5"/>
            </svg>
          </a>
        </div>
      </div>
    </section>

    <!-- About Section -->
    <section id="about" class="section">
      <div class="section-container">
        <div class="section-header">
          <h2 class="section-title">
            Transforming Food Access in <span class="text-gradient">Chicago</span>
          </h2>
          <p class="section-subtitle">
            Chicago Food Connect is an innovative initiative addressing food insecurity in Chicago's food deserts through technology, community partnerships, and sustainable solutions.
          </p>
        </div>
      </div>
    </section>

    <!-- Food Ordering Section -->
    <section id="foodOrdering" class="section food-ordering-section">
      <div class="section-container">
        <div class="section-header">
          <h2 class="section-title">
            <span class="text-gradient">Healthy Meals</span> Delivered
          </h2>
          <p class="section-subtitle">
            Order nutritious, free meals from local community kitchens and support food access in your neighborhood.
          </p>
        </div>

        <div class="food-grid">
          <!-- White Rice -->
          <div class="food-card" data-item="white-rice">
            <img src="https://images.unsplash.com/photo-1586201375761-83865001e31c?auto=format&fit=crop&w=400&q=80" alt="White Rice" class="food-image">
            <div class="food-content">
              <h3 class="food-title">Premium White Rice</h3>
              <p class="food-description">High-quality long grain white rice, perfect as a base for any meal. Rich in energy and easy to digest.</p>
              <div class="food-price">Free</div>
              <div class="quantity-controls">
                <button class="quantity-btn" onclick="decreaseQuantity('white-rice')">-</button>
                <span class="quantity-display" id="qty-white-rice">1</span>
                <button class="quantity-btn" onclick="increaseQuantity('white-rice')">+</button>
              </div>
              <button class="add-to-cart-btn" onclick="addToCart('white-rice', 'Premium White Rice', 0, 'https://images.unsplash.com/photo-1586201375761-83865001e31c?auto=format&fit=crop&w=400&q=80')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5"/>
                </svg>
                Add to Cart
              </button>
            </div>
          </div>

          <!-- Brown Rice -->
          <div class="food-card" data-item="brown-rice">
            <img src="https://images.unsplash.com/photo-1516684669134-de6f7c473a2a?auto=format&fit=crop&w=400&q=80" alt="Brown Rice" class="food-image">
            <div class="food-content">
              <h3 class="food-title">Organic Brown Rice</h3>
              <p class="food-description">Nutrient-rich whole grain brown rice, packed with fiber, vitamins, and minerals for sustained energy.</p>
              <div class="food-price">Free</div>
              <div class="quantity-controls">
                <button class="quantity-btn" onclick="decreaseQuantity('brown-rice')">-</button>
                <span class="quantity-display" id="qty-brown-rice">1</span>
                <button class="quantity-btn" onclick="increaseQuantity('brown-rice')">+</button>
              </div>
              <button class="add-to-cart-btn" onclick="addToCart('brown-rice', 'Organic Brown Rice', 0, 'https://images.unsplash.com/photo-1516684669134-de6f7c473a2a?auto=format&fit=crop&w=400&q=80')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5"/>
                </svg>
                Add to Cart
              </button>
            </div>
          </div>

          <!-- Fresh Bread -->
          <div class="food-card" data-item="fresh-bread">
            <img src="https://images.unsplash.com/photo-1509440159596-0249088772ff?auto=format&fit=crop&w=400&q=80" alt="Fresh Bread" class="food-image">
            <div class="food-content">
              <h3 class="food-title">Artisan Fresh Bread</h3>
              <p class="food-description">Freshly baked whole grain bread, soft inside with a crispy crust. Perfect for sandwiches or toast.</p>
              <div class="food-price">Free</div>
              <div class="quantity-controls">
                <button class="quantity-btn" onclick="decreaseQuantity('fresh-bread')">-</button>
                <span class="quantity-display" id="qty-fresh-bread">1</span>
                <button class="quantity-btn" onclick="increaseQuantity('fresh-bread')">+</button>
              </div>
              <button class="add-to-cart-btn" onclick="addToCart('fresh-bread', 'Artisan Fresh Bread', 0, 'https://images.unsplash.com/photo-1509440159596-0249088772ff?auto=format&fit=crop&w=400&q=80')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5"/>
                </svg>
                Add to Cart
              </button>
            </div>
          </div>

          <!-- Fresh Bananas -->
          <div class="food-card" data-item="bananas">
            <img src="https://images.unsplash.com/photo-1571771894821-ce9b6c11b08e?auto=format&fit=crop&w=400&q=80" alt="Fresh Bananas" class="food-image">
            <div class="food-content">
              <h3 class="food-title">Fresh Bananas</h3>
              <p class="food-description">Sweet, ripe bananas packed with potassium, vitamins, and natural energy. Perfect for snacks or smoothies.</p>
              <div class="food-price">Free</div>
              <div class="quantity-controls">
                <button class="quantity-btn" onclick="decreaseQuantity('bananas')">-</button>
                <span class="quantity-display" id="qty-bananas">1</span>
                <button class="quantity-btn" onclick="increaseQuantity('bananas')">+</button>
              </div>
              <button class="add-to-cart-btn" onclick="addToCart('bananas', 'Fresh Bananas', 0, 'https://images.unsplash.com/photo-1571771894821-ce9b6c11b08e?auto=format&fit=crop&w=400&q=80')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5"/>
                </svg>
                Add to Cart
              </button>
            </div>
          </div>

          <!-- Fresh Apples -->
          <div class="food-card" data-item="apples">
            <img src="https://images.unsplash.com/photo-1560806887-1e4cd0b6cbd6?auto=format&fit=crop&w=400&q=80" alt="Fresh Apples" class="food-image">
            <div class="food-content">
              <h3 class="food-title">Crisp Fresh Apples</h3>
              <p class="food-description">Crispy, sweet apples rich in fiber and vitamin C. Great for healthy snacking and cooking.</p>
              <div class="food-price">Free</div>
              <div class="quantity-controls">
                <button class="quantity-btn" onclick="decreaseQuantity('apples')">-</button>
                <span class="quantity-display" id="qty-apples">1</span>
                <button class="quantity-btn" onclick="increaseQuantity('apples')">+</button>
              </div>
              <button class="add-to-cart-btn" onclick="addToCart('apples', 'Crisp Fresh Apples', 0, 'https://images.unsplash.com/photo-1560806887-1e4cd0b6cbd6?auto=format&fit=crop&w=400&q=80')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5"/>
                </svg>
                Add to Cart
              </button>
            </div>
          </div>

          <!-- Fresh Lettuce -->
          <div class="food-card" data-item="lettuce">
            <img src="https://images.unsplash.com/photo-1622206151226-18ca2c9ab4a1?auto=format&fit=crop&w=400&q=80" alt="Fresh Lettuce" class="food-image">
            <div class="food-content">
              <h3 class="food-title">Garden Fresh Lettuce</h3>
              <p class="food-description">Crisp, green lettuce leaves perfect for salads, sandwiches, and wraps. Low in calories, high in nutrients.</p>
              <div class="food-price">Free</div>
              <div class="quantity-controls">
                <button class="quantity-btn" onclick="decreaseQuantity('lettuce')">-</button>
                <span class="quantity-display" id="qty-lettuce">1</span>
                <button class="quantity-btn" onclick="increaseQuantity('lettuce')">+</button>
              </div>
              <button class="add-to-cart-btn" onclick="addToCart('lettuce', 'Garden Fresh Lettuce', 0, 'https://images.unsplash.com/photo-1622206151226-18ca2c9ab4a1?auto=format&fit=crop&w=400&q=80')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5"/>
                </svg>
                Add to Cart
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="contact-section">
      <div class="section-container">
        <div class="section-header">
          <h2 class="section-title">Get in <span class="text-gradient">Touch</span></h2>
          <p class="section-subtitle">
            Have questions or want to get involved? We'd love to hear from you.
          </p>
        </div>

        <div class="contact-grid">
          <div class="contact-card">
            <div class="contact-icon">üìß</div>
            <h3 class="contact-title">Email Us</h3>
            <p class="contact-info">info@chicagofoodconnect.org</p>
          </div>

          <div class="contact-card">
            <div class="contact-icon">üì±</div>
            <h3 class="contact-title">Call Us</h3>
            <p class="contact-info">(312) 555-FOOD</p>
          </div>

          <div class="contact-card">
            <div class="contact-icon">üìç</div>
            <h3 class="contact-title">Visit Us</h3>
            <p class="contact-info">123 Community St, Chicago, IL 60601</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
      <div class="footer-container">
        <div class="footer-content">
          <div class="footer-section">
            <h3>Oasis</h3>
            <p>Connecting communities to nutritious food and creating sustainable solutions for food insecurity in Chicago.</p>
            <p>Together, we're building a healthier, more equitable food system for all.</p>
          </div>

          <div class="footer-section">
            <h3>Quick Links</h3>
            <ul class="footer-links">
              <li><a href="#hero">Home</a></li>
              <li><a href="#about">About Us</a></li>
              <li><a href="#foodOrdering">Order Food</a></li>
              <li><a href="donation.html">Donate</a></li>
              <li><a href="#contact">Contact</a></li>
            </ul>
          </div>

          <div class="footer-section">
            <h3>Get Involved</h3>
            <ul class="footer-links">
              <li><a href="#">Volunteer</a></li>
              <li><a href="#">Partner with Us</a></li>
              <li><a href="#">Community Events</a></li>
              <li><a href="#">Newsletter</a></li>
              <li><a href="#">Impact Report</a></li>
            </ul>
          </div>

          <div class="footer-section">
            <h3>Support</h3>
            <ul class="footer-links">
              <li><a href="#">Help Center</a></li>
              <li><a href="#">Privacy Policy</a></li>
              <li><a href="#">Terms of Service</a></li>
              <li><a href="#">Accessibility</a></li>
              <li><a href="#">Feedback</a></li>
            </ul>
          </div>
        </div>

        <div class="footer-bottom">
          <p>&copy; 2025 Chicago Food Connect (Oasis). All rights reserved. Made with ‚ù§Ô∏è for the community.</p>
        </div>
      </div>
    </footer>
  </div>

 // ...existing code...

<!-- Google Maps API - Replace with a valid API key -->
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&libraries=places&callback=initMap" async defer></script>

// ...existing code...

<script>
  // Firebase Configuration
  const firebaseConfig = {
    apiKey: "AIzaSyCRRc6wHGWPDzIlxlBVqlPwwoYZOtIq_-Y",
    authDomain: "oasis-180a0.firebaseapp.com",
    projectId: "oasis-180a0",
    storageBucket: "oasis-180a0.firebasestorage.app",
    messagingSenderId: "932376179447",
    appId: "1:932376179447:web:0e70f3d72f62655f9399f2",
    measurementId: "G-6872VF9D2Q"
  };

  // Initialize Firebase
  let auth, db;
  
  try {
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    auth = firebase.auth();
    db = firebase.firestore();
    console.log('Firebase initialized successfully');
  } catch (error) {
    console.error('Firebase initialization error:', error);
  }

  // App state
  let isLoginMode = true;
  let currentUser = null;
  let cart = [];
  let map;
  let selectedLocation = null;
  let foodPantries = [];

  // Food Pantry Data
  const foodPantryData = [
    {
      id: 'pantry1',
      name: 'Chicago South Side Food Pantry',
      lat: 41.7584,
      lng: -87.6348,
      address: '1234 S State St, Chicago, IL 60628',
      phone: '(312) 555-0101',
      hours: 'Mon-Fri: 9AM-5PM, Sat: 10AM-3PM',
      neededItems: ['Canned Goods', 'Rice', 'Pasta', 'Baby Formula', 'Diapers'],
      needsVolunteers: true,
      volunteerRoles: ['Food Sorting', 'Distribution', 'Administrative Support'],
      description: 'Serving the South Side community for over 20 years.'
    },
    {
      id: 'pantry2',
      name: 'West Chicago Community Kitchen',
      lat: 41.8781,
      lng: -87.7298,
      address: '5678 W Madison St, Chicago, IL 60644',
      phone: '(312) 555-0102',
      hours: 'Tue-Thu: 10AM-6PM, Sat: 9AM-2PM',
      neededItems: ['Fresh Vegetables', 'Bread', 'Meat', 'Milk', 'Eggs'],
      needsVolunteers: true,
      volunteerRoles: ['Cooking', 'Serving', 'Cleanup'],
      description: 'Community kitchen providing hot meals and groceries.'
    },
    {
      id: 'pantry3',
      name: 'North Side Food Bank',
      lat: 41.9484,
      lng: -87.6553,
      address: '9012 N Clark St, Chicago, IL 60640',
      phone: '(312) 555-0103',
      hours: 'Mon-Wed-Fri: 8AM-4PM, Sun: 12PM-4PM',
      neededItems: ['Cereal', 'Peanut Butter', 'Canned Soup', 'Toiletries', 'Cleaning Supplies'],
      needsVolunteers: false,
      volunteerRoles: [],
      description: 'Large food bank serving multiple neighborhoods.'
    },
    {
      id: 'pantry4',
      name: 'Downtown Emergency Food Center',
      lat: 41.8781,
      lng: -87.6298,
      address: '321 W Loop St, Chicago, IL 60601',
      phone: '(312) 555-0104',
      hours: 'Daily: 7AM-9PM',
      neededItems: ['Ready-to-eat meals', 'Water', 'Snacks', 'Blankets'],
      needsVolunteers: true,
      volunteerRoles: ['Intake', 'Resource Navigation', 'Security'],
      description: 'Emergency food assistance for downtown area.'
    },
    {
      id: 'pantry5',
      name: 'East Side Family Resource Center',
      lat: 41.8181,
      lng: -87.5698,
      address: '4567 E 95th St, Chicago, IL 60617',
      phone: '(312) 555-0105',
      hours: 'Mon-Fri: 11AM-7PM',
      neededItems: ['Baby Food', 'Formula', 'Diapers', 'School Supplies', 'Clothing'],
      needsVolunteers: true,
      volunteerRoles: ['Childcare', 'Tutoring', 'Family Services'],
      description: 'Comprehensive family support with food assistance.'
    }
  ];

  // DOM elements
  const authForm = document.getElementById('authForm');
  const authTitle = document.getElementById('authTitle');
  const authSubtitle = document.getElementById('authSubtitle');
  const authButton = document.getElementById('authButton');
  const authSwitchText = document.getElementById('authSwitchText');
  const authSwitchLink = document.getElementById('authSwitchLink');
  const nameGroup = document.getElementById('nameGroup');
  const locationGroup = document.getElementById('locationGroup');
  const contactGroup = document.getElementById('contactGroup');
  const confirmPasswordGroup = document.getElementById('confirmPasswordGroup');

  // Show/hide pages
  function showPage(pageId) {
    document.querySelectorAll('.page').forEach(page => {
      page.classList.remove('active');
    });
    document.getElementById(pageId).classList.add('active');
  }

  // Show error message
  function showError(message) {
    const errorEl = document.getElementById('errorMessage') || document.getElementById('locationErrorMessage');
    const successEl = document.getElementById('successMessage') || document.getElementById('locationSuccessMessage');
    if (errorEl) {
      errorEl.textContent = message;
      errorEl.style.display = 'block';
    }
    if (successEl) {
      successEl.style.display = 'none';
    }
  }

  // Show success message
  function showSuccess(message) {
    const successEl = document.getElementById('successMessage') || document.getElementById('locationSuccessMessage');
    const errorEl = document.getElementById('errorMessage') || document.getElementById('locationErrorMessage');
    if (successEl) {
      successEl.textContent = message;
      successEl.style.display = 'block';
    }
    if (errorEl) {
      errorEl.style.display = 'none';
    }
  }

  // Hide messages
  function hideMessages() {
    const errorEls = document.querySelectorAll('.error-message');
    const successEls = document.querySelectorAll('.success-message');
    errorEls.forEach(el => el.style.display = 'none');
    successEls.forEach(el => el.style.display = 'none');
  }

  // Toggle between login and signup
  function toggleAuthMode() {
    isLoginMode = !isLoginMode;
    hideMessages();

    if (isLoginMode) {
      authTitle.textContent = 'Welcome Back';
      authSubtitle.textContent = 'Sign in to access fresh, healthy meals in your area';
      authButton.textContent = 'Sign In';
      authSwitchText.textContent = "Don't have an account?";
      authSwitchLink.textContent = 'Sign up';
      nameGroup.style.display = 'none';
      locationGroup.style.display = 'none';
      contactGroup.style.display = 'none';
      confirmPasswordGroup.style.display = 'none';
    } else {
      authTitle.textContent = 'Join Our Community';
      authSubtitle.textContent = 'Create an account to start ordering fresh, healthy meals';
      authButton.textContent = 'Sign Up';
      authSwitchText.textContent = 'Already have an account?';
      authSwitchLink.textContent = 'Sign in';
      nameGroup.style.display = 'block';
      locationGroup.style.display = 'block';
      contactGroup.style.display = 'block';
      confirmPasswordGroup.style.display = 'block';
    }
  }

  // Handle auth switch
  function handleAuthSwitch() {
    toggleAuthMode();
    hideMessages();
    return false;
  }

  // Handle authentication form submission
  authForm.addEventListener('submit', async function(e) {
    e.preventDefault();
    hideMessages();
    
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value;
    
    if (!email || !password) {
      showError('Please fill in all required fields.');
      return;
    }

    authButton.disabled = true;
    authButton.textContent = isLoginMode ? 'Signing In...' : 'Creating Account...';

    try {
      if (isLoginMode) {
        // Login
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        currentUser = userCredential.user;
        showSuccess('Successfully signed in!');
        
        // Check if user has location data
        const userDoc = await db.collection('users').doc(currentUser.uid).get();
        if (userDoc.exists() && userDoc.data().selectedLocation) {
          // User has location, go to main page
          setTimeout(() => showPage('mainPage'), 1000);
        } else {
          // User needs to set location
          setTimeout(() => showPage('locationPage'), 1000);
        }
      } else {
        // Register
        const fullName = document.getElementById('fullName').value.trim();
        const location = document.getElementById('location').value.trim();
        const contact = document.getElementById('contact').value.trim();
        const confirmPassword = document.getElementById('confirmPassword').value;
        
        if (!fullName || !location || !contact) {
          showError('Please fill in all required fields.');
          authButton.disabled = false;
          authButton.textContent = 'Sign Up';
          return;
        }
        
        if (password !== confirmPassword) {
          showError('Passwords do not match.');
          authButton.disabled = false;
          authButton.textContent = 'Sign Up';
          return;
        }

        if (password.length < 6) {
          showError('Password must be at least 6 characters long.');
          authButton.disabled = false;
          authButton.textContent = 'Sign Up';
          return;
        }

        // Create user account
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        currentUser = userCredential.user;

        // Update user profile
        await currentUser.updateProfile({
          displayName: fullName
        });

        // Save additional user data to Firestore
        await db.collection('users').doc(currentUser.uid).set({
          fullName: fullName,
          email: email,
          location: location,
          contact: contact,
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          isActive: true
        });

        showSuccess('Account created successfully! Please set your location.');
        
        // Auto switch to login mode and go to location page
        setTimeout(() => {
          showPage('locationPage');
        }, 1500);
      }
    } catch (error) {
      console.error('Authentication error:', error);
      
      let errorMsg = 'An error occurred. Please try again.';
      
      switch (error.code) {
        case 'auth/user-not-found':
          errorMsg = 'No account found with this email address.';
          break;
        case 'auth/wrong-password':
          errorMsg = 'Incorrect password.';
          break;
        case 'auth/email-already-in-use':
          errorMsg = 'An account with this email already exists.';
          break;
        case 'auth/invalid-email':
          errorMsg = 'Please enter a valid email address.';
          break;
        case 'auth/weak-password':
          errorMsg = 'Password should be at least 6 characters.';
          break;
        case 'auth/network-request-failed':
          errorMsg = 'Network error. Please check your connection.';
          break;
        default:
          errorMsg = error.message;
      }
      
      showError(errorMsg);
    } finally {
      authButton.disabled = false;
      authButton.textContent = isLoginMode ? 'Sign In' : 'Sign Up';
    }
  });

  // Firebase auth state listener
  auth.onAuthStateChanged((user) => {
    if (user) {
      currentUser = user;
      console.log('User is signed in:', user.email);
    } else {
      currentUser = null;
      console.log('User is signed out');
      showPage('authPage');
    }
  });

  // Location confirmation
  document.getElementById('confirmLocationBtn').addEventListener('click', async function() {
    if (!selectedLocation) {
      showError('Please select a location on the map.');
      return;
    }

    if (!currentUser) {
      showError('Please sign in first.');
      return;
    }

    try {
      this.disabled = true;
      this.textContent = 'Saving Location...';

      // Save location to Firestore
      await db.collection('users').doc(currentUser.uid).update({
        selectedLocation: selectedLocation,
        locationUpdatedAt: firebase.firestore.FieldValue.serverTimestamp()
      });

      showSuccess('Location saved successfully!');
      
      setTimeout(() => {
        showPage('mainPage');
      }, 1000);

    } catch (error) {
      console.error('Location save error:', error);
      showError('Failed to save location. Please try again.');
    } finally {
      this.disabled = false;
      this.textContent = 'Confirm Location & Continue';
    }
  });

  // Alternative map implementation using Leaflet (free alternative to Google Maps)
  function initMapWithLeaflet() {
    // Create map fallback using OpenStreetMap
    const mapDiv = document.getElementById('map');
    
    // Use a simpler map implementation
    mapDiv.innerHTML = `
      <div style="width: 100%; height: 400px; background: linear-gradient(135deg, #e2e8f0, #cbd5e1); border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 2rem;">
        <div style="background: white; border-radius: 16px; padding: 2rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 400px;">
          <h3 style="color: var(--primary-navy); margin-bottom: 1rem;">üìç Select Your Chicago Location</h3>
          
          <div style="margin-bottom: 1.5rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Search Location:</label>
            <input type="text" id="locationSearchInput" placeholder="Enter your Chicago address..." 
                   style="width: 100%; padding: 0.75rem; border: 2px solid var(--neutral-200); border-radius: 8px;">
          </div>
          
          <div style="margin-bottom: 1.5rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Or select from popular areas:</label>
            <select id="chicagoAreas" style="width: 100%; padding: 0.75rem; border: 2px solid var(--neutral-200); border-radius: 8px;">
              <option value="">Choose an area...</option>
              <option value="41.8781,-87.6298">Downtown/Loop</option>
              <option value="41.7584,-87.6348">South Side</option>
              <option value="41.9484,-87.6553">North Side</option>
              <option value="41.8781,-87.7298">West Side</option>
              <option value="41.8181,-87.5698">East Side</option>
              <option value="41.9200,-87.6400">Lincoln Park</option>
              <option value="41.9300,-87.6500">Lakeview</option>
              <option value="41.8900,-87.6200">River North</option>
            </select>
          </div>
          
          <div style="background: var(--neutral-50); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
            <strong>Food Pantries Near You:</strong>
            <div id="nearbyPantries" style="margin-top: 0.5rem; font-size: 0.9rem; color: var(--neutral-600);">
              <div>üè™ Chicago South Side Food Pantry</div>
              <div>üè™ West Chicago Community Kitchen</div>
              <div>üè™ North Side Food Bank</div>
              <div>üè™ Downtown Emergency Food Center</div>
              <div>üè™ East Side Family Resource Center</div>
            </div>
          </div>
        </div>
      </div>
    `;

    // Add event listeners for location selection
    const locationInput = document.getElementById('locationSearchInput');
    const areaSelect = document.getElementById('chicagoAreas');
    const selectedLocationEl = document.getElementById('selectedLocation');
    const confirmBtn = document.getElementById('confirmLocationBtn');

    locationInput.addEventListener('input', function() {
      if (this.value.trim()) {
        selectedLocation = {
          lat: 41.8781, // Default to Chicago center
          lng: -87.6298,
          address: this.value.trim()
        };
        selectedLocationEl.textContent = this.value.trim();
        confirmBtn.disabled = false;
        areaSelect.value = '';
      }
    });

    areaSelect.addEventListener('change', function() {
      if (this.value) {
        const [lat, lng] = this.value.split(',').map(Number);
        const areaName = this.options[this.selectedIndex].text;
        
        selectedLocation = {
          lat: lat,
          lng: lng,
          address: areaName + ', Chicago, IL'
        };
        
        selectedLocationEl.textContent = areaName + ', Chicago, IL';
        confirmBtn.disabled = false;
        locationInput.value = '';
        
        // Update nearby pantries based on selection
        updateNearbyPantries(areaName);
      }
    });
  }

  function updateNearbyPantries(areaName) {
    const nearbyPantriesDiv = document.getElementById('nearbyPantries');
    
    // Filter pantries based on area
    let relevantPantries = [];
    
    switch(areaName) {
      case 'Downtown/Loop':
        relevantPantries = ['Downtown Emergency Food Center', 'West Chicago Community Kitchen'];
        break;
      case 'South Side':
        relevantPantries = ['Chicago South Side Food Pantry', 'East Side Family Resource Center'];
        break;
      case 'North Side':
        relevantPantries = ['North Side Food Bank', 'West Chicago Community Kitchen'];
        break;
      case 'West Side':
        relevantPantries = ['West Chicago Community Kitchen', 'Chicago South Side Food Pantry'];
        break;
      case 'East Side':
        relevantPantries = ['East Side Family Resource Center', 'Chicago South Side Food Pantry'];
        break;
      default:
        relevantPantries = ['Chicago South Side Food Pantry', 'West Chicago Community Kitchen'];
    }
    
    nearbyPantriesDiv.innerHTML = relevantPantries.map(name => `<div>üè™ ${name}</div>`).join('');
  }

  // Pantry Info Window Functions (same as before)
  function showPantryInfo(pantry) {
    const infoContent = `
      <div style="max-width: 300px; padding: 1rem;">
        <h3 style="margin: 0 0 0.5rem 0; color: var(--primary-navy);">${pantry.name}</h3>
        <p style="margin: 0 0 1rem 0; color: var(--neutral-600); font-size: 0.9rem;">${pantry.description}</p>
        
        <div style="margin-bottom: 1rem;">
          <strong>Address:</strong><br>
          <span style="color: var(--neutral-600);">${pantry.address}</span>
        </div>
        
        <div style="margin-bottom: 1rem;">
          <strong>Phone:</strong> <span style="color: var(--neutral-600);">${pantry.phone}</span>
        </div>
        
        <div style="margin-bottom: 1rem;">
          <strong>Hours:</strong><br>
          <span style="color: var(--neutral-600);">${pantry.hours}</span>
        </div>
        
        <div style="margin-bottom: 1.5rem;">
          <strong>Items Needed:</strong><br>
          <div style="display: flex; flex-wrap: wrap; gap: 0.25rem; margin-top: 0.5rem;">
            ${pantry.neededItems.map(item => `
              <span style="background: var(--neutral-100); color: var(--neutral-700); padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.8rem;">${item}</span>
            `).join('')}
          </div>
        </div>
        
        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
          <button onclick="openDonationModal('${pantry.id}')" style="background: var(--gradient-primary); color: white; border: none; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; font-size: 0.8rem;">
            üíù Donate
          </button>
          ${pantry.needsVolunteers ? `
            <button onclick="openVolunteerModal('${pantry.id}')" style="background: var(--gradient-secondary); color: white; border: none; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; font-size: 0.8rem;">
              ü§ù Volunteer
            </button>
          ` : ''}
          <button onclick="showMoreInfo('${pantry.id}')" style="background: var(--neutral-500); color: white; border: none; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; font-size: 0.8rem;">
            ‚ÑπÔ∏è More Info
          </button>
        </div>
      </div>
    `;
    
    return infoContent;
  }

  function openDonationModal(pantryId) {
    const pantry = foodPantryData.find(p => p.id === pantryId);
    
    const modalHTML = `
      <div id="donationModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 10000;">
        <div style="background: white; border-radius: 20px; padding: 2rem; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h3 style="margin: 0; color: var(--primary-navy);">Donate to ${pantry.name}</h3>
            <button onclick="closeDonationModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
          </div>
          
          <div style="margin-bottom: 1.5rem;">
            <h4 style="margin-bottom: 0.5rem;">Most Needed Items:</h4>
            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
              ${pantry.neededItems.map(item => `
                <label style="display: flex; align-items: center; gap: 0.5rem; background: var(--neutral-50); padding: 0.5rem; border-radius: 8px; cursor: pointer;">
                  <input type="checkbox" name="donationItems" value="${item}">
                  <span>${item}</span>
                </label>
              `).join('')}
            </div>
          </div>
          
          <div style="margin-bottom: 1.5rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Other Items (specify):</label>
            <textarea id="otherItems" placeholder="List any other items you'd like to donate..." style="width: 100%; padding: 0.75rem; border: 2px solid var(--neutral-200); border-radius: 8px; resize: vertical; min-height: 80px;"></textarea>
          </div>
          
          <div style="margin-bottom: 1.5rem;">
            <label style="display: flex; align-items: center; gap: 0.5rem;">
              <input type="checkbox" id="needPickup">
              <span>I need pickup assistance for my donation</span>
            </label>
          </div>
          
          <div id="pickupDetails" style="display: none; margin-bottom: 1.5rem; padding: 1rem; background: var(--neutral-50); border-radius: 8px;">
            <h4 style="margin-bottom: 1rem;">Pickup Details:</h4>
            <div style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 0.5rem;">Pickup Address:</label>
              <input type="text" id="pickupAddress" placeholder="Enter your address" style="width: 100%; padding: 0.75rem; border: 2px solid var(--neutral-200); border-radius: 8px;">
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
              <div>
                <label style="display: block; margin-bottom: 0.5rem;">Preferred Date:</label>
                <input type="date" id="pickupDate" style="width: 100%; padding: 0.75rem; border: 2px solid var(--neutral-200); border-radius: 8px;">
              </div>
              <div>
                <label style="display: block; margin-bottom: 0.5rem;">Preferred Time:</label>
                <select id="pickupTime" style="width: 100%; padding: 0.75rem; border: 2px solid var(--neutral-200); border-radius: 8px;">
                  <option value="">Select time</option>
                  <option value="morning">Morning (9AM-12PM)</option>
                  <option value="afternoon">Afternoon (12PM-5PM)</option>
                  <option value="evening">Evening (5PM-8PM)</option>
                </select>
              </div>
            </div>
          </div>
          
          <div style="display: flex; gap: 1rem;">
            <button onclick="closeDonationModal()" style="flex: 1; background: var(--neutral-300); color: var(--neutral-700); border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer;">Cancel</button>
            <button onclick="submitDonation('${pantryId}')" style="flex: 1; background: var(--gradient-primary); color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer;">Submit Donation</button>
          </div>
        </div>
      </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHTML);
    
    // Add pickup details toggle
    document.getElementById('needPickup').addEventListener('change', function() {
      document.getElementById('pickupDetails').style.display = this.checked ? 'block' : 'none';
    });
  }

  function openVolunteerModal(pantryId) {
    const pantry = foodPantryData.find(p => p.id === pantryId);
    
    const modalHTML = `
      <div id="volunteerModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 10000;">
        <div style="background: white; border-radius: 20px; padding: 2rem; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h3 style="margin: 0; color: var(--primary-navy);">Volunteer at ${pantry.name}</h3>
            <button onclick="closeVolunteerModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
          </div>
          
          <div style="margin-bottom: 1.5rem;">
            <h4 style="margin-bottom: 0.5rem;">Available Volunteer Roles:</h4>
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
              ${pantry.volunteerRoles.map(role => `
                <label style="display: flex; align-items: center; gap: 0.5rem; background: var(--neutral-50); padding: 0.5rem; border-radius: 8px; cursor: pointer;">
                  <input type="radio" name="volunteerRole" value="${role}">
                  <span>${role}</span>
                </label>
              `).join('')}
            </div>
          </div>
          
          <div style="margin-bottom: 1.5rem;">
            <h4 style="margin-bottom: 1rem;">Preferred Schedule:</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
              <div>
                <label style="display: block; margin-bottom: 0.5rem;">Preferred Day:</label>
                <select id="volunteerDay" style="width: 100%; padding: 0.75rem; border: 2px solid var(--neutral-200); border-radius: 8px;">
                  <option value="">Select day</option>
                  <option value="monday">Monday</option>
                  <option value="tuesday">Tuesday</option>
                  <option value="wednesday">Wednesday</option>
                  <option value="thursday">Thursday</option>
                  <option value="friday">Friday</option>
                  <option value="saturday">Saturday</option>
                  <option value="sunday">Sunday</option>
                </select>
              </div>
              <div>
                <label style="display: block; margin-bottom: 0.5rem;">Preferred Time:</label>
                <select id="volunteerTime" style="width: 100%; padding: 0.75rem; border: 2px solid var(--neutral-200); border-radius: 8px;">
                  <option value="">Select time</option>
                  <option value="morning">Morning (9AM-12PM)</option>
                  <option value="afternoon">Afternoon (12PM-5PM)</option>
                  <option value="evening">Evening (5PM-8PM)</option>
                </select>
              </div>
            </div>
          </div>
          
          <div style="margin-bottom: 1.5rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Additional Comments:</label>
            <textarea id="volunteerComments" placeholder="Tell us about your experience, availability, or any special skills..." style="width: 100%; padding: 0.75rem; border: 2px solid var(--neutral-200); border-radius: 8px; resize: vertical; min-height: 80px;"></textarea>
          </div>
          
          <div style="display: flex; gap: 1rem;">
            <button onclick="closeVolunteerModal()" style="flex: 1; background: var(--neutral-300); color: var(--neutral-700); border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer;">Cancel</button>
            <button onclick="submitVolunteer('${pantryId}')" style="flex: 1; background: var(--gradient-secondary); color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer;">Submit Application</button>
          </div>
        </div>
      </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHTML);
  }

  function showMoreInfo(pantryId) {
    const pantry = foodPantryData.find(p => p.id === pantryId);
    
    const modalHTML = `
      <div id="infoModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 10000;">
        <div style="background: white; border-radius: 20px; padding: 2rem; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h3 style="margin: 0; color: var(--primary-navy);">${pantry.name}</h3>
            <button onclick="closeInfoModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
          </div>
          
          <div style="margin-bottom: 1.5rem;">
            <h4 style="margin-bottom: 0.5rem; color: var(--neutral-800);">About Us</h4>
            <p style="color: var(--neutral-600); line-height: 1.6;">${pantry.description}</p>
          </div>
          
          <div style="margin-bottom: 1.5rem;">
            <h4 style="margin-bottom: 0.5rem; color: var(--neutral-800);">Hours of Operation</h4>
            <p style="color: var(--neutral-600); font-family: monospace; background: var(--neutral-50); padding: 1rem; border-radius: 8px;">${pantry.hours}</p>
          </div>
          
          <div style="margin-bottom: 1.5rem;">
            <h4 style="margin-bottom: 0.5rem; color: var(--neutral-800);">Contact Information</h4>
            <div style="background: var(--neutral-50); padding: 1rem; border-radius: 8px;">
              <p style="margin: 0 0 0.5rem 0;"><strong>Address:</strong> ${pantry.address}</p>
              <p style="margin: 0 0 0.5rem 0;"><strong>Phone:</strong> ${pantry.phone}</p>
              <p style="margin: 0;"><strong>Services:</strong> Food Distribution, Community Support</p>
            </div>
          </div>
          
          <div style="margin-bottom: 1.5rem;">
            <h4 style="margin-bottom: 0.5rem; color: var(--neutral-800);">Current Needs</h4>
            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
              ${pantry.neededItems.map(item => `
                <span style="background: var(--secondary-green); color: white; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.9rem;">${item}</span>
              `).join('')}
            </div>
          </div>
          
          ${pantry.needsVolunteers ? `
            <div style="margin-bottom: 1.5rem;">
              <h4 style="margin-bottom: 0.5rem; color: var(--neutral-800);">Volunteer Opportunities</h4>
              <div style="background: var(--neutral-50); padding: 1rem; border-radius: 8px;">
                ${pantry.volunteerRoles.map(role => `
                  <p style="margin: 0 0 0.5rem 0; color: var(--neutral-700);">‚Ä¢ ${role}</p>
                `).join('')}
              </div>
            </div>
          ` : ''}
          
          <div style="display: flex; gap: 1rem;">
            <button onclick="closeInfoModal()" style="flex: 1; background: var(--neutral-500); color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer;">Close</button>
            <button onclick="window.open('tel:${pantry.phone}')" style="flex: 1; background: var(--gradient-primary); color: white; border: none; padding: 0.75rem; border-radius: 8px; cursor: pointer;">üìû Call Now</button>
          </div>
        </div>
      </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHTML);
  }

  // Modal close functions
  function closeDonationModal() {
    const modal = document.getElementById('donationModal');
    if (modal) modal.remove();
  }

  function closeVolunteerModal() {
    const modal = document.getElementById('volunteerModal');
    if (modal) modal.remove();
  }

  function closeInfoModal() {
    const modal = document.getElementById('infoModal');
    if (modal) modal.remove();
  }

  // Submit functions
  async function submitDonation(pantryId) {
    if (!currentUser) {
      alert('Please sign in to submit a donation.');
      return;
    }

    const selectedItems = Array.from(document.querySelectorAll('input[name="donationItems"]:checked')).map(cb => cb.value);
    const otherItems = document.getElementById('otherItems').value;
    const needPickup = document.getElementById('needPickup').checked;
    
    const donationData = {
      userId: currentUser.uid,
      userEmail: currentUser.email,
      pantryId: pantryId,
      selectedItems: selectedItems,
      otherItems: otherItems,
      needPickup: needPickup,
      submittedAt: firebase.firestore.FieldValue.serverTimestamp(),
      status: 'pending'
    };

    if (needPickup) {
      donationData.pickupDetails = {
        address: document.getElementById('pickupAddress').value,
        date: document.getElementById('pickupDate').value,
        time: document.getElementById('pickupTime').value
      };
    }

    try {
      await db.collection('donations').add(donationData);
      alert('Thank you for your donation! We will contact you soon with details.');
      closeDonationModal();
    } catch (error) {
      console.error('Error submitting donation:', error);
      alert('Failed to submit donation. Please try again.');
    }
  }

  async function submitVolunteer(pantryId) {
    if (!currentUser) {
      alert('Please sign in to submit a volunteer application.');
      return;
    }

    const selectedRole = document.querySelector('input[name="volunteerRole"]:checked')?.value;
    const day = document.getElementById('volunteerDay').value;
    const time = document.getElementById('volunteerTime').value;
    const comments = document.getElementById('volunteerComments').value;

    if (!selectedRole || !day || !time) {
      alert('Please fill in all required fields.');
      return;
    }

    const volunteerData = {
      userId: currentUser.uid,
      userEmail: currentUser.email,
      pantryId: pantryId,
      role: selectedRole,
      preferredDay: day,
      preferredTime: time,
      comments: comments,
      submittedAt: firebase.firestore.FieldValue.serverTimestamp(),
      status: 'pending'
    };

    try {
      await db.collection('volunteers').add(volunteerData);
      alert('Thank you for your interest in volunteering! We will contact you soon with next steps.');
      closeVolunteerModal();
    } catch (error) {
      console.error('Error submitting volunteer application:', error);
      alert('Failed to submit application. Please try again.');
    }
  }

  // Logout function
  function logout() {
    auth.signOut().then(() => {
      cart = [];
      selectedLocation = null;
      updateCartUI();
      showPage('authPage');
    }).catch((error) => {
      console.error('Logout error:', error);
    });
  }

  // Cart functionality
  function increaseQuantity(itemId) {
    const qtyElement = document.getElementById(`qty-${itemId}`);
    let quantity = parseInt(qtyElement.textContent);
    quantity++;
    qtyElement.textContent = quantity;
  }

  function decreaseQuantity(itemId) {
    const qtyElement = document.getElementById(`qty-${itemId}`);
    let quantity = parseInt(qtyElement.textContent);
    if (quantity > 1) {
      quantity--;
      qtyElement.textContent = quantity;
    }
  }

  function addToCart(itemId, name, price, image) {
    const quantity = parseInt(document.getElementById(`qty-${itemId}`).textContent);
    
    const existingItem = cart.find(item => item.id === itemId);
    if (existingItem) {
      existingItem.quantity += quantity;
    } else {
      cart.push({
        id: itemId,
        name: name,
        price: price,
        image: image,
        quantity: quantity
      });
    }
    
    updateCartUI();
    updateCartCount();
    
    // Reset quantity to 1
    document.getElementById(`qty-${itemId}`).textContent = '1';
  }

  function updateCartCount() {
    const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
    document.getElementById('cartCount').textContent = totalItems;
  }

  function updateCartUI() {
    const cartItems = document.getElementById('cartItems');
    const cartTotal = document.getElementById('cartTotal');
    
    if (cart.length === 0) {
      cartItems.innerHTML = '<p style="text-align: center; color: var(--neutral-500); padding: 2rem;">Your cart is empty</p>';
      cartTotal.textContent = 'Free';
      return;
    }
    
    cartItems.innerHTML = cart.map(item => `
      <div class="cart-item">
        <img src="${item.image}" alt="${item.name}">
        <div class="cart-item-details">
          <div class="cart-item-name">${item.name}</div>
          <div class="cart-item-price">${item.price === 0 ? 'Free' : '$' + item.price.toFixed(2)}</div>
        </div>
        <div style="display: flex; align-items: center; gap: 0.5rem;">
          <span style="font-weight: 600;">x${item.quantity}</span>
          <button onclick="removeFromCart('${item.id}')" style="background: none; border: none; color: var(--neutral-400); cursor: pointer; padding: 0.25rem;">‚úï</button>
        </div>
      </div>
    `).join('');
    
    cartTotal.textContent = 'Free';
  }

  function removeFromCart(itemId) {
    cart = cart.filter(item => item.id !== itemId);
    updateCartUI();
    updateCartCount();
  }

  // Cart sidebar functionality
  document.getElementById('cartIcon').addEventListener('click', function() {
    document.getElementById('cartSidebar').classList.add('open');
    document.getElementById('cartOverlay').classList.add('open');
  });

  document.getElementById('closeCart').addEventListener('click', function() {
    document.getElementById('cartSidebar').classList.remove('open');
    document.getElementById('cartOverlay').classList.remove('open');
  });

  document.getElementById('cartOverlay').addEventListener('click', function() {
    document.getElementById('cartSidebar').classList.remove('open');
    document.getElementById('cartOverlay').classList.remove('open');
  });

  // Checkout functionality
  document.getElementById('checkoutBtn').addEventListener('click', function() {
    if (cart.length === 0) {
      alert('Your cart is empty!');
      return;
    }
    
    // Update order summary
    const orderSummaryItems = document.getElementById('orderSummaryItems');
    orderSummaryItems.innerHTML = cart.map(item => `
      <div class="summary-item">
        <span>${item.name} x${item.quantity}</span>
        <span>Free</span>
      </div>
    `).join('');
    
    // Show payment modal
    document.getElementById('paymentModal').classList.add('open');
    
    // Close cart sidebar
    document.getElementById('cartSidebar').classList.remove('open');
    document.getElementById('cartOverlay').classList.remove('open');
  });

  function closePaymentModal() {
    document.getElementById('paymentModal').classList.remove('open');
  }

  async function confirmOrder() {
    if (!currentUser) {
      alert('Please sign in to place an order.');
      return;
    }

    try {
      // Save order to Firestore
      await db.collection('orders').add({
        userId: currentUser.uid,
        userEmail: currentUser.email,
        items: cart,
        total: 0, // Free
        status: 'confirmed',
        orderDate: firebase.firestore.FieldValue.serverTimestamp(),
        location: selectedLocation
      });

      alert('Order confirmed! You will receive pickup instructions shortly.');
      
      // Clear cart
      cart = [];
      updateCartUI();
      updateCartCount();
      
      // Close modal
      closePaymentModal();
      
    } catch (error) {
      console.error('Order confirmation error:', error);
      alert('Failed to confirm order. Please try again.');
    }
  }

  // Initialize map fallback when page loads
  window.addEventListener('load', () => {
    // Try Google Maps first, fallback to custom implementation
    setTimeout(() => {
      if (typeof google === 'undefined' || !google.maps) {
        console.log('Google Maps not available, using fallback map');
        initMapWithLeaflet();
      } else {
        console.log('Google Maps available, initializing...');
        // initMap(); // Uncomment if you have a valid Google Maps API key
        initMapWithLeaflet(); // Use fallback for now
      }
    }, 1000);
  });

  // Global callback for Google Maps (if available)
  window.initMap = function() {
    // This will be called by Google Maps API
    console.log('Google Maps callback triggered');
    // Initialize Google Maps here if API key is valid
  };
</script>
</body>
</html>
